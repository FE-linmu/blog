(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{359:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_04vue源码剖析01"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_04vue源码剖析01"}},[t._v("#")]),t._v(" 04Vue源码剖析01")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/vuejs/vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue 源码地址"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"文件结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件结构"}},[t._v("#")]),t._v(" 文件结构")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-864d2f88a6e5301e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"总体"}})]),t._v(" "),s("h4",{attrs:{id:"源码目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#源码目录"}},[t._v("#")]),t._v(" 源码目录")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-eabf476be39ddf81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),s("h2",{attrs:{id:"调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调试"}},[t._v("#")]),t._v(" 调试")]),t._v(" "),s("h3",{attrs:{id:"环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[t._v("#")]),t._v(" 环境搭建")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("安装依赖：npm i")])]),t._v(" "),s("li",[s("p",[t._v("安装 rollup：npm i -g rollup")])]),t._v(" "),s("li",[s("p",[t._v("修改 dev 脚本，添加 sourcemap，package.json")])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加 sourceMap 调试的时候可以看到源码结构")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(' "rollup '),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("w "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c scripts"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("sourcemap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("environment "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("web"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\nfull"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v('dev"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("运行开发命令：npm run dev")])]),t._v(" "),s("li",[s("p",[t._v("引入前面创建的 vue.js，samples/commits/index.html")])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../../dist/vue.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("术语解释：\nruntime：仅包含运行时，不包含编译器，体积较小，适合 Webpack 环境，平时开发时一般使用的是此版本\ncommon：cjs规范，用于 Webpack1\nesm：ES模块，用于 Webpack2+\numd: universal module definition，兼容cjs和amd，用于浏览器（今天使用的版本）")])]),t._v(" "),s("p",[t._v("【注】：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("整个路径下不要出现中文路径")])]),t._v(" "),s("li",[s("p",[t._v("安装依赖时，在下载 phantomjs 时会很慢，可以直接终止掉，不影响后面调试")])])]),t._v(" "),s("h3",{attrs:{id:"入口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入口"}},[t._v("#")]),t._v(" 入口")]),t._v(" "),s("p",[t._v("dev 脚本中 -c scripts/config.js 指明配置文件所在")]),t._v(" "),s("p",[t._v("参数 TARGET:web-full-dev 指明输出文件配置项，line:123")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Runtime+compiler development build (Browser)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web-full-dev'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    entry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web/entry-runtime-with-compiler.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 入口")]),t._v("\n    dest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/vue.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标文件")]),t._v("\n    format"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'umd'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出规范")]),t._v("\n    env"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" he"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./entity-decoder'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    banner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"初始化流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化流程"}},[t._v("#")]),t._v(" 初始化流程")]),t._v(" "),s("h4",{attrs:{id:"整体流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整体流程"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("new Vue()")]),t._v(" "),s("ul",[s("li",[t._v("_init()")])])]),t._v(" "),s("li",[s("p",[t._v("$mount()")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("mountComponent()")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("updateComponent()")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("render()")])]),t._v(" "),s("li",[s("p",[t._v("update()")])])])]),t._v(" "),s("li",[s("p",[t._v("new Watcher()")])])])])])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-5d70eff6e3eeabb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA",target:"_blank",rel:"noopener noreferrer"}},[t._v("生命周期图示"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("测试用例："),s("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/examples/test/01-init.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("01-init.html"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"入口-platforms-web-entry-runtime-with-compiler-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入口-platforms-web-entry-runtime-with-compiler-js"}},[t._v("#")]),t._v(" 入口 platforms/web/entry-runtime-with-compiler.js")]),t._v(" "),s("p",[t._v("扩展默认 $mount 方法")]),t._v(" "),s("p",[t._v("处理 template 或 el 选项")]),t._v(" "),s("blockquote",[s("p",[t._v("遇到测试代码直接折起来跳过即可")])]),t._v(" "),s("h4",{attrs:{id:"src-platforms-web-runtime-index-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#src-platforms-web-runtime-index-js"}},[t._v("#")]),t._v(" src/platforms/web/runtime/index.js")]),t._v(" "),s("p",[t._v("安装 Web 平台特有指令和组件")]),t._v(" "),s("p",[t._v("定义__patch__：补丁函数，执行 patching 算法进行更新")]),t._v(" "),s("p",[t._v("定义 $mount：挂载 Vue 实例到指定宿主元素（获得 dom 并替换宿主元素）")]),t._v(" "),s("h4",{attrs:{id:"core-index-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-index-js"}},[t._v("#")]),t._v(" core/index.js")]),t._v(" "),s("p",[t._v("初始化全局api")]),t._v(" "),s("p",[t._v("具体如下：")]),t._v(" "),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[t._v("Vue.set = set\nVue.delete = del\nVue.nextTick = nextTick\ninitUse(Vue) // 实现Vue.use函数\ninitMixin(Vue) // 实现Vue.mixin函数\ninitExtend(Vue) // 实现Vue.extend函数\ninitAssetRegisters(Vue) // 注册实现Vue.component/directive/filter\n")])])]),s("h4",{attrs:{id:"core-instance-index-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-instance-index-js"}},[t._v("#")]),t._v(" core/instance/index.js")]),t._v(" "),s("p",[t._v("Vue 构造函数定义")]),t._v(" "),s("p",[t._v("定义 Vue 实例 API")]),t._v(" "),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[t._v("function Vue (options) {\n // 构造函数仅执行了_init\n this._init(options)\n}\ninitMixin(Vue)  // 实现init函数\nstateMixin(Vue) // 状态相关api $data,$props,$set,$delete,$watch\neventsMixin(Vue)// 事件相关api $on,$once,$off,$emit\nlifecycleMixin(Vue) // 生命周期api _update,$forceUpdate,$destroy\nrenderMixin(Vue)// 渲染api _render,$nextTick\n")])])]),s("h4",{attrs:{id:"core-instance-init-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-instance-init-js"}},[t._v("#")]),t._v(" core/instance/init.js")]),t._v(" "),s("p",[t._v("创建组件实例，初始化其数据、属性、事件等")]),t._v(" "),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[t._v("initLifecycle(vm) // $parent,$root,$children,$refs\ninitEvents(vm)  // 处理父组件传递的事件和回调\ninitRender(vm)  // $slots,$scopedSlots,_c,$createElement\ncallHook(vm, 'beforeCreate')\ninitInjections(vm) // 获取注入数据\ninitState(vm)  // 初始化props，methods，data，computed，watch\ninitProvide(vm)  // 提供数据注入\ncallHook(vm, 'created')\n")])])]),s("h4",{attrs:{id:"mount"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mount"}},[t._v("#")]),t._v(" $mount")]),t._v(" "),s("ul",[s("li",[t._v("mountComponent")])]),t._v(" "),s("p",[t._v("执行挂载，获取vdom并转换为dom")]),t._v(" "),s("ul",[s("li",[t._v("new Watcher()")])]),t._v(" "),s("p",[t._v("创建组件渲染 watcher")]),t._v(" "),s("ul",[s("li",[t._v("updateComponent()")])]),t._v(" "),s("p",[t._v("执行初始化或更新")]),t._v(" "),s("ul",[s("li",[t._v("update()")])]),t._v(" "),s("p",[t._v("初始化或更新，将传入vdom转换为dom，初始化时执行的是dom创建操作")]),t._v(" "),s("ul",[s("li",[t._v("render() src\\core\\instance\\render.js")])]),t._v(" "),s("p",[t._v("渲染组件，获取vdom")]),t._v(" "),s("p",[t._v("测试代码："),s("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/examples/test/01-init.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("examples\\test\\01-init.html"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"整体流程捋一捋"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整体流程捋一捋"}},[t._v("#")]),t._v(" 整体流程捋一捋")]),t._v(" "),s("p",[t._v("new Vue() => _init() => $mount() => mountComponent() =>\nupdateComponent() => new Watcher() => render() => _update()")]),t._v(" "),s("p",[s("strong",[t._v("思考一道相关面试题：谈谈vue生命周期?")])]),t._v(" "),s("p",[t._v("概念：组件创建、更新和销毁过程")]),t._v(" "),s("p",[t._v("用途：生命周期钩子使我们可以在合适的时间做合适的事情")]),t._v(" "),s("p",[t._v("分类列举：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("初始化阶段：beforeCreate、created、beforeMount、mounted")])]),t._v(" "),s("li",[s("p",[t._v("更新阶段：beforeUpdate、updated")])]),t._v(" "),s("li",[s("p",[t._v("销毁阶段：beforeDestroy、destroyed")])])]),t._v(" "),s("p",[t._v("应用：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("created 时，所有数据准备就绪，适合做数据获取、赋值等数据操作")])]),t._v(" "),s("li",[s("p",[t._v("mounted时，$el 已生成，可以获取 dom；子组件也已挂载，可以访问它们")])]),t._v(" "),s("li",[s("p",[t._v("updated 时，数值变化已作用于 dom，可以获取 dom 最新状态")])]),t._v(" "),s("li",[s("p",[t._v("destroyed 时，组件实例已销毁，适合取消定时器等操作")])])]),t._v(" "),s("h2",{attrs:{id:"数据响应式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据响应式"}},[t._v("#")]),t._v(" 数据响应式")]),t._v(" "),s("p",[t._v("数据响应式是 MVVM 框架的一大特点，通过某种策略可以感知数据的变化。Vue 中利用了 JS 语言特性 Object.defineProperty()，通过定义对象属性 getter/setter 拦截对属性的访问。")]),t._v(" "),s("p",[t._v("具体实现是在 Vue 初始化时，会调用 initState，它会初始化 data，props 等，这里着重关注 data 初始化")]),t._v(" "),s("h3",{attrs:{id:"整体流程-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整体流程-2"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),s("h4",{attrs:{id:"initstate-vm-component-src-core-instance-state-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initstate-vm-component-src-core-instance-state-js"}},[t._v("#")]),t._v(" initState (vm: Component) src\\core\\instance\\state.js")]),t._v(" "),s("p",[t._v("初始化数据，包括 props、methods、data、computed 和 watch")]),t._v(" "),s("h4",{attrs:{id:"initdata-核心代码是将-data-数据响应化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initdata-核心代码是将-data-数据响应化"}},[t._v("#")]),t._v(" initData 核心代码是将 data 数据响应化")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initData")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("vm"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行数据响应化")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* asRootData */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"core-observer-index-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-index-js"}},[t._v("#")]),t._v(" core/observer/index.js")]),t._v(" "),s("p",[t._v("observe 方法返回一个 Observer 实例")]),t._v(" "),s("h4",{attrs:{id:"core-observer-index-js-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-index-js-2"}},[t._v("#")]),t._v(" core/observer/index.js")]),t._v(" "),s("p",[t._v("Observer 对象根据数据类型执行对应的响应化操作")]),t._v(" "),s("p",[t._v("defineReactive 定义对象属性的 getter/setter，getter 负责添加依赖，setter 负责通知更新")]),t._v(" "),s("h4",{attrs:{id:"core-observer-dep-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-dep-js"}},[t._v("#")]),t._v(" core/observer/dep.js")]),t._v(" "),s("p",[t._v("Dep 负责管理一组 Watcher，包括 watcher 实例的增删及通知更新")]),t._v(" "),s("h4",{attrs:{id:"watcher"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#watcher"}},[t._v("#")]),t._v(" Watcher")]),t._v(" "),s("p",[t._v("Watcher 解析一个表达式并收集依赖，当数值变化时触发回调函数，常用于 $watch API 和指令中。\n每个组件也会有对应的 Watcher，数值变化会触发其 update 函数导致重新渲染")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("dep"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("相关API： $watcher")])]),t._v(" "),s("p",[t._v("测试代码 "),s("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/examples/test/02-1-reactive.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("examples\\test\\02-1-reactive.html"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"数组响应化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数组响应化"}},[t._v("#")]),t._v(" 数组响应化")]),t._v(" "),s("p",[t._v("数组数据变化的侦测跟对象不同，我们操作数组通常使用 push、pop、splice 等方法，此时没有办法得知数据变化。所以vue中采取的策略是拦截这些方法并通知 dep。")]),t._v(" "),s("h4",{attrs:{id:"src-core-observer-array-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#src-core-observer-array-js"}},[t._v("#")]),t._v(" src\\core\\observer\\array.js")]),t._v(" "),s("p",[t._v("为数组原型中的7个可以改变内容的方法定义拦截器 Observer 中覆盖数组原型")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isArray")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换数组原型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v(" protoAugment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arrayMethods"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// value.__proto__ = arrayMethods")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("observeArray")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("测试代码 "),s("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/examples/test/02-2-reactive-arr.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("examples\\test\\02-2-reactive-arr.html"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("相关API： Vue.set()/delete()")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  arr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\narr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xxx\nVue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nVue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("Vue 源码剖析的部分可能会比较乱，因为看源码太过于细枝末节的话，大概率会迷失在里面。尽量看其中的思想，以及某些可以借鉴的代码，比如最基本的响应式的 Object.defineProperty、编译时用到的 fragment 等等，项目中如果有需要了，恰好可以借鉴到，我觉得这才是学习源码正确的姿势。毕竟鲁迅曾经说过：不会应用的学习都是在耍流氓。")]),t._v(" "),s("p",[t._v("鲁迅说：我没说过。")]),t._v(" "),s("p",[t._v("最后附上我对这部分内容学习的一个简单的导图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-82ba61b8c3134d11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"Vue源码剖析.png"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);