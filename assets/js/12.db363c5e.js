(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{354:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_06源码剖析03"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_06源码剖析03"}},[t._v("#")]),t._v(" 06源码剖析03")]),t._v(" "),a("h2",{attrs:{id:"模板编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板编译"}},[t._v("#")]),t._v(" 模板编译")]),t._v(" "),a("p",[t._v("模板编译的主要目标是"),a("strong",[t._v("将模板（template）转为渲染函数（render）")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-6414db9de69c56a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"template==>render"}})]),t._v(" "),a("h3",{attrs:{id:"模板编译必要性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板编译必要性"}},[t._v("#")]),t._v(" 模板编译必要性")]),t._v(" "),a("p",[t._v("Vue2.0 需要用到 Vnode 描述视图以及各种交互，手写显然不切实际，因此用户只需编写类似 HTML 代码的 Vue 模板，通过编译器将模板转换为可返回 Vnode 的 render 函数。")]),t._v(" "),a("h3",{attrs:{id:"体验模板编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#体验模板编译"}},[t._v("#")]),t._v(" 体验模板编译")]),t._v(" "),a("p",[t._v("带编译器的版本中，可以使用 template 或 el 的方式生命模板，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/examples/test/06-1-compiler.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试 demo"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v('(function anonymous (\n  ) {\n    with (this) {\n      return _c(\'div\', { attrs: { "id": "demo" } }, [_c(\'h1\', [_v("Vue模板编\n    译")]),_v(" "),_c(\'p\',[_v(_s(foo))]),_v(" "),_c(\'comp\')],1)}\n    })\n')])])]),a("p",[t._v("输出结果大致如下：")]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v('(function anonymous () {\n  with (this) {\n    return _c(\'div\', { attrs: { "id": "demo" } }, [\n      _c(\'h1\', [_v("Vue模板编译")]),\n      _v(" "), _c(\'p\', [_v(_s(foo))]),\n      _v(" "), _c(\'comp\')], 1)\n  }\n})\n')])])]),a("ul",[a("li",[a("p",[t._v("元素节点使用 createElement 创建，别名 _c")])]),t._v(" "),a("li",[a("p",[t._v("本文节点使用 createTextVNode 创建，别名 _v")])]),t._v(" "),a("li",[a("p",[t._v("表达式先使用 toString 格式化，别名 _s")])]),t._v(" "),a("li",[a("p",[t._v("其他渲染 helpers："),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/core/instance/render-helpers/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src\\core\\instance\\render-helpers\\index.js"),a("OutboundLink")],1)])])]),t._v(" "),a("h3",{attrs:{id:"整体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),a("h4",{attrs:{id:"compiletofunctions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compiletofunctions"}},[t._v("#")]),t._v(" compileToFunctions")]),t._v(" "),a("p",[t._v("若指定 template 或 el 选项，则会执行编译，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/platforms/web/entry-runtime-with-compiler.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("platforms\\web\\entry-runtime-with-compiler.js"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"编译过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译过程"}},[t._v("#")]),t._v(" 编译过程")]),t._v(" "),a("p",[t._v("编译分为三步：解析、优化和生成，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src\\compiler\\index.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/examples/test/06-1-compiler.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试 demo"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"模板编译过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板编译过程"}},[t._v("#")]),t._v(" 模板编译过程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-7f1514c067ccb207.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("p",[t._v("实现模板编译共有三个阶段：解析、优化和生成。")]),t._v(" "),a("h4",{attrs:{id:"解析-parse"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析-parse"}},[t._v("#")]),t._v(" 解析 - parse")]),t._v(" "),a("p",[t._v("解析器将模板解析为抽象语法树，基于 AST 可以做优化或者代码生成工作。")]),t._v(" "),a("p",[t._v("调试查看得到的 AST，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/parser/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("/src/compiler/parser/index.js"),a("OutboundLink")],1),t._v("，结构如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-76ae1dca7ad50693.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("p",[t._v("解析器内部分了 "),a("strong",[t._v("HTML 解析器、文本解析器和过滤解析器")]),t._v("，最主要是 HTML 解析器。")]),t._v(" "),a("h4",{attrs:{id:"优化-optimize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化-optimize"}},[t._v("#")]),t._v(" 优化 - optimize")]),t._v(" "),a("p",[t._v("优化器的作用是在 AST 中找出静态子树并打上标记。静态子树是在 AST 中永远不变的节点，如纯文本节点。")]),t._v(" "),a("p",[t._v("标记静态子树的好处：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("每次重新渲染，不需要为静态子树创建新节点；")])]),t._v(" "),a("li",[a("p",[t._v("虚拟 DOM 中 patch 时，可以跳过静态子树。")])])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/examples/test/06-2-compiler-optimize.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试 demo"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("代码实现，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/optimizer.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src/compiler/optimizer.js - optimize"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("标记结束")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-653ed33d2283fa92.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("h4",{attrs:{id:"代码生成-generage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码生成-generage"}},[t._v("#")]),t._v(" 代码生成 - generage")]),t._v(" "),a("p",[t._v("将 AST 转换成渲染函数中的内容，即代码字符串。")]),t._v(" "),a("p",[t._v("generate 方法生成渲染函数代码，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/codegen/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src/compiler/codegen/index.js"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("生成的 code：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("_c('div',{attrs:{\"id\":\"demo\"}},[\n_c('h1',[_v(\"Vue.js测试\")]),\n_c('p',[_v(_s(foo))])\n])")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n")])])]),a("h3",{attrs:{id:"典型指令的实现：v-if、v-for"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#典型指令的实现：v-if、v-for"}},[t._v("#")]),t._v(" 典型指令的实现：v-if、v-for")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-df269d6d7c2c700c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("p",[t._v("着重观察几个结构性指令的解析过程。")]),t._v(" "),a("p",[t._v("解析 v-if："),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/parser/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("parser/index.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("processIf 用于处理 v-if 解析：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processIf")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" exp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAndRemoveAttr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-if'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("if "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exp\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addIfCondition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      exp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      block"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" el\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAndRemoveAttr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-else'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("else "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" elseif "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAndRemoveAttr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-else-if'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elseif"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elseif "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elseif\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("解析结果：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-d35be5c22a212a1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("p",[t._v("代码生成，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/compiler/codegen/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("codegen/index.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("genIfConditions 等用于生产条件语句相关代码。")]),t._v(" "),a("p",[t._v("生成结果：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"with(this){return _c('div',{attrs:{\"")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),t._v('demo"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('"\n')])])]),a("p",[t._v("解析 v-for："),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/master/Vue/06%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9003/src/compiler/parser/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("parser/index.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("processFor 用于处理 v-for 指令：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processFor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ASTElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" exp\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAndRemoveAttr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-for'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseFor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("extend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Invalid v-for expression: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("exp"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rawAttrsMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-for'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v('解析结果：v-for="item in items"')]),t._v(" "),a("p",[t._v('for:"items"')]),t._v(" "),a("p",[t._v('alias:"item"')]),t._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15424855-87cb73a8f4a64f2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),a("p",[t._v("代码生成，"),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/compiler/codegen/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src\\compiler\\codegen\\index.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("genFor 用于生成响应代码。")]),t._v(" "),a("p",[t._v("生成结果：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"with(this){return _c('div',{attrs:{\"")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),t._v("demo"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}},[_m(0),_v("')]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'p'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_l")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'comp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('"\n')])])]),a("p",[t._v("v-if、v-for 这些指令只能在编译器阶段处理，如果我们要在 render 函数处理条件或循环只能使用 if 和 for。")]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v("Vue.component('comp', {\n  props: ['foo'],\n  render (h) { // 渲染内容跟foo的值挂钩，只能⽤if语句\n    if (this.foo == 'foo') {\n      return h('div', 'foo')\n    }\n    return h('div', 'bar')\n  }\n})\n")])])]),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v('(function anonymous (\n) {\n  with (this) {\n    return _c(\'div\', { attrs: { "id": "demo" } }, [_m(0), _v(" "), (foo) ? _c(\'p\',\n      [_v(_s(foo))]) : _e(), _v(" "), _c(\'comp\')], 1)\n  }\n})\n')])])]),a("h2",{attrs:{id:"组件化机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件化机制"}},[t._v("#")]),t._v(" 组件化机制")]),t._v(" "),a("h3",{attrs:{id:"组件声明：vue-component"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件声明：vue-component"}},[t._v("#")]),t._v(" 组件声明：Vue.component()")]),t._v(" "),a("p",[t._v("initAssetRegisters(Vue) "),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/core/global-api/assets.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("src/core/global-api/assets.js"),a("OutboundLink")],1),t._v("，组件注册使用 extend 方法将配置转换为构造函数并添加到 components 选项。")]),t._v(" "),a("h3",{attrs:{id:"组件实例创建及挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件实例创建及挂载"}},[t._v("#")]),t._v(" 组件实例创建及挂载")]),t._v(" "),a("p",[t._v("观察生成的渲染函数：")]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v('"with(this){return _c(\'div\',{attrs:{"id":"demo"}},[\n  _c(\'h1\', [_v("虚拟DOM")]), _v(" "),\n  _c(\'p\', [_v(_s(foo))]), _v(" "),\n  _c(\'comp\') // 对于组件的处理并⽆特殊之处\n  ], 1)}"\n')])])]),a("h3",{attrs:{id:"整体流程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程-2"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),a("p",[t._v("首先创建的是跟实例，首次 _render() 时，会得到整棵树的 Vnode 结构，其中自定义组件相关的主要有：")]),t._v(" "),a("p",[t._v("整体流程：")]),t._v(" "),a("p",[t._v("new Vue() => $mount() => vm._render(h) => createElement() => createComponent() => patch => createElm => createComponent()")]),t._v(" "),a("h4",{attrs:{id:"createelement-src-core-vdom-create-element-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createelement-src-core-vdom-create-element-js"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/core/vdom/create-element.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("_createElement - src\\core\\vdom\\create-element.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("_createElement 实际执行 Vnode 创建的函数，由于传入 tag 是非保留标签，因此判定为自定义组件通过 createComponent 去创建。")]),t._v(" "),a("h4",{attrs:{id:"createcomponent-src-core-vdom-create-component-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createcomponent-src-core-vdom-create-component-js"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/core/vdom/create-component.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("createComponent - src/core/vdom/create-component.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("创建组件 Vnode，保存了上一步处理得到的组件构造函数，props，事件等")]),t._v(" "),a("h3",{attrs:{id:"创建组件实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建组件实例"}},[t._v("#")]),t._v(" 创建组件实例")]),t._v(" "),a("p",[t._v("根组件执行更新函数时，会递归创建子元素和子组件，入口 createElm。")]),t._v(" "),a("h4",{attrs:{id:"createele-core-vdom-patch-js-line751"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createele-core-vdom-patch-js-line751"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/core/vdom/patch.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("createEle() core/vdom/patch.js line751"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("首次执行 _update() 时，patch() 会通过 createEle() 创建根元素，子元素创建研究从这里开始。")]),t._v(" "),a("h4",{attrs:{id:"createcomponent-core-vdom-patch-js-line144"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createcomponent-core-vdom-patch-js-line144"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/bei-yang/Front-end-architect/blob/324e49d5f095015a95fd8e804dbc17bddb10007f/Vue/04%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%9001/vue-study-web20-source/src/core/vdom/patch.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("createComponent core/vdom/patch.js line144"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("自定义组件创建：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 组件实例创建、挂载")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* hydrating */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("componentInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 元素引⽤指定vnode.elm，元素属性创建等")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插⼊到⽗元素")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isReactivated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactivateComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("Vue源码学习使我们能够深入理解原理，解答很多开发中的疑惑，规避很多潜在的错误，写出更好的代码。学习大神的代码，能够学习编程思想，设计模式，训练基本功，提升内力。")])])}),[],!1,null,null,null);s.default=e.exports}}]);