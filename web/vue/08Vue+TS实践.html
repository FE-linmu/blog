<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>08Vue+TS实践 | 林慕的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="记录分享前端技术">
    <link rel="preload" href="/blog/assets/css/0.styles.fa7169f5.css" as="style"><link rel="preload" href="/blog/assets/js/app.5357dcc8.js" as="script"><link rel="preload" href="/blog/assets/js/2.ef134f65.js" as="script"><link rel="preload" href="/blog/assets/js/14.56b0e56b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8198d6ab.js"><link rel="prefetch" href="/blog/assets/js/11.aadf7bb5.js"><link rel="prefetch" href="/blog/assets/js/12.db363c5e.js"><link rel="prefetch" href="/blog/assets/js/13.afd82ec4.js"><link rel="prefetch" href="/blog/assets/js/15.86b8cdae.js"><link rel="prefetch" href="/blog/assets/js/16.a5e31507.js"><link rel="prefetch" href="/blog/assets/js/17.3d7007d4.js"><link rel="prefetch" href="/blog/assets/js/3.3ae9385c.js"><link rel="prefetch" href="/blog/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/blog/assets/js/5.f8be39f3.js"><link rel="prefetch" href="/blog/assets/js/6.61a92354.js"><link rel="prefetch" href="/blog/assets/js/7.3388c26e.js"><link rel="prefetch" href="/blog/assets/js/8.51f06735.js"><link rel="prefetch" href="/blog/assets/js/9.fee2630d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.fa7169f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">林慕的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/web/vue/01组件化实战.html" class="nav-link">
  Web全栈架构师
</a></div><div class="nav-item"><a href="https://github.com/bei-yang/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/web/vue/01组件化实战.html" class="nav-link">
  Web全栈架构师
</a></div><div class="nav-item"><a href="https://github.com/bei-yang/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/web/vue/01组件化实战.html" class="sidebar-link">01组件化实战</a></li><li><a href="/blog/web/vue/02全家桶（Vue-router&amp;&amp;Vuex）源码实现.html" class="sidebar-link">02全家桶（Vue-router&amp;&amp;Vuex）源码实现</a></li><li><a href="/blog/web/vue/03Vue基础版实现.html" class="sidebar-link">03Vue基础版实现</a></li><li><a href="/blog/web/vue/04源码剖析01.html" class="sidebar-link">04Vue源码剖析01</a></li><li><a href="/blog/web/vue/05源码剖析02.html" class="sidebar-link">05源码剖析02</a></li><li><a href="/blog/web/vue/06源码剖析03.html" class="sidebar-link">06源码剖析03</a></li><li><a href="/blog/web/vue/07服务端渲染SSR.html" class="sidebar-link">07服务端渲染SSR</a></li><li><a href="/blog/web/vue/08Vue+TS实践.html" class="active sidebar-link">08Vue+TS实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/vue/08Vue+TS实践.html#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/blog/web/vue/08Vue+TS实践.html#ts-特点" class="sidebar-link">TS 特点</a></li><li class="sidebar-sub-header"><a href="/blog/web/vue/08Vue+TS实践.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog/web/vue/09项目最佳实践.html" class="sidebar-link">09项目最佳实践</a></li><li><a href="/blog/web/vue/10Vue3初探+响应式原理剖析.html" class="sidebar-link">10Vue3初探+响应式原理剖析</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_08vue-ts实践"><a href="#_08vue-ts实践" class="header-anchor">#</a> 08Vue+TS实践</h1> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <p>新建一个基于 TS 的 Vue 项目：</p> <p><img src="https://upload-images.jianshu.io/upload_images/15424855-fddc772db04a9cfe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p> <p>在已存在项目中安装 TS</p> <div class="language-js extra-class"><pre class="language-js"><code>vue add @vue<span class="token operator">/</span>typescript
</code></pre></div><p><img src="https://upload-images.jianshu.io/upload_images/15424855-8562daa9ccffd01a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <blockquote><p>请暂时忽略引发的几处 Error，它们不影响项目运行，我们将在后面处理它们。</p></blockquote> <h2 id="ts-特点"><a href="#ts-特点" class="header-anchor">#</a> TS 特点</h2> <p>TypeScript 是 JavaScript 的超集，它可编译为纯 JavaScript，是一种给 JavaScript 添加特性的语言扩展。TS 有如下特点：</p> <ul><li><p>类型注解和编译时类型检查</p></li> <li><p>基于类的面向对象编程</p></li> <li><p>泛型</p></li> <li><p>接口</p></li> <li><p>装饰器</p></li> <li><p>类型声明</p></li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/15424855-9243a5adefdfd5b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p> <h3 id="类型注解和编译时类型检查"><a href="#类型注解和编译时类型检查" class="header-anchor">#</a> 类型注解和编译时类型检查</h3> <p>使用类型注解约束变量类型，编译器可以做静态类型检查，使程序更加健壮。</p> <h4 id="基础类型"><a href="#基础类型" class="header-anchor">#</a> 基础类型</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// ts-test.ts</span>
<span class="token keyword">let</span> var1<span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token comment">// 类型注解</span>
var1 <span class="token operator">=</span> <span class="token string">&quot;林慕&quot;</span> <span class="token comment">// 正确</span>
var1 <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment">// 错误</span>
</code></pre></div><p>编译器类型推断可省略这个语法</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> var2 <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre></div><p>常见的原始类型：</p> <ul><li><p>string</p></li> <li><p>number</p></li> <li><p>boolean</p></li> <li><p>undefined</p></li> <li><p>null</p></li> <li><p>symbol</p></li></ul> <p>类型数组</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> arr<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'林慕'</span><span class="token punctuation">]</span>  <span class="token comment">// 或 Array&lt;string&gt;</span>
</code></pre></div><p>任意类型 any</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> varAny<span class="token operator">:</span> <span class="token builtin">any</span>
varAny <span class="token operator">=</span> <span class="token string">'xx'</span>
varAny <span class="token operator">=</span> <span class="token number">3</span>
</code></pre></div><p>任意类型也可用于数组</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> arrAny<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
arrAny <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'free'</span><span class="token punctuation">]</span>
arrAny <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>
</code></pre></div><p>函数中的类型约束</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token parameter">person<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'hello,'</span><span class="token operator">+</span>person
<span class="token punctuation">}</span>
</code></pre></div><p>void 类型，常用于没有返回值的函数</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>范例：HelloWorld.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>feature in features<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>feature<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{feature}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Prop<span class="token punctuation">,</span> Vue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-property-decorator&quot;</span><span class="token punctuation">;</span>
@Component
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
 features<span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;类型注解&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;编译型语言&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="类型别名"><a href="#类型别名" class="header-anchor">#</a> 类型别名</h4> <p>使用类型别名自定义类型。</p> <p>可以用下面这种方式定义对象类型：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> objType<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>bar<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">}</span>
</code></pre></div><p>使用 type 定义类型别名，使用更便捷，还能复用：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> Foobar <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> aliasType<span class="token operator">:</span> Foobar
</code></pre></div><p>范例：使用类型别名定义 Feature，types/index.ts</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">type</span> Feature <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用自定义类型，HelloWorld.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--修改模板--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>feature in features<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>feature.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{feature.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 导入接口</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Feature <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/types'</span>

@Component
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改数据类型</span>
  features<span class="token operator">:</span> Feature<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'类型注解'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="联合类型"><a href="#联合类型" class="header-anchor">#</a> 联合类型</h4> <p>希望某个变量或参数的类型是多种类型其中之一。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> union<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span>
union <span class="token operator">=</span> <span class="token string">'1'</span>
union <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// 以上都是可以的</span>
</code></pre></div><h4 id="交叉类型"><a href="#交叉类型" class="header-anchor">#</a> 交叉类型</h4> <p>想要定义某种由多种类型合并而成的类型使用交叉类型。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> First <span class="token operator">=</span> <span class="token punctuation">{</span>first<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">}</span>
<span class="token keyword">type</span> Second <span class="token operator">=</span> <span class="token punctuation">{</span>second<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">}</span>
<span class="token comment">// fas将同时拥有属性first和second</span>
<span class="token keyword">type</span> fas <span class="token operator">=</span> First <span class="token operator">&amp;</span> Second
</code></pre></div><p>范例：利用交叉类型给 Feature 添加一个 selected 属性。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// types/index.ts</span>
<span class="token keyword">type</span> Select <span class="token operator">=</span> <span class="token punctuation">{</span>
  selected<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> FeatureSelect <span class="token operator">=</span> Feature <span class="token operator">&amp;</span> Select
</code></pre></div><p>使用这个 FeatureSelect，HelloWorld.vue</p> <div class="language-ts extra-class"><pre class="language-ts"><code>features<span class="token operator">:</span> FeatureSelect<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'类型注解'</span><span class="token punctuation">,</span> selected<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'编译型语言'</span><span class="token punctuation">,</span> selected<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{selected: feature.selected}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{feature.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

.selected {
  background-color: rgb(168, 212, 247)
}
</code></pre></div><h3 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h3> <p>必填参：参数一旦声明，就要求传递，且类型需符合。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 02-function.ts</span>
<span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">person<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'hello,'</span> <span class="token operator">+</span> person
<span class="token punctuation">}</span>
<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span>
</code></pre></div><p>可选参数：参数名后面加上问号，变成可选参数。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">person<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> msg<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'hello,'</span> <span class="token operator">+</span> person
<span class="token punctuation">}</span>
</code></pre></div><p>默认值：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span>person<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'hello,'</span> <span class="token operator">+</span> person
<span class="token punctuation">}</span>
</code></pre></div><p><strong>函数重载</strong>：以参数数量或类型区分多个同名函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 重载1</span>
<span class="token keyword">function</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token comment">// 重载2</span>
<span class="token keyword">function</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token function-variable function">cb1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">,</span><span class="token function-variable function">cb2</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">v1<span class="token operator">:</span>any<span class="token punctuation">,</span> v2<span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token comment">// 实现</span>
<span class="token keyword">function</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token function-variable function">cb1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> cb2<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">v1<span class="token operator">:</span> any<span class="token punctuation">,</span> v2<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>cb1 <span class="token operator">&amp;&amp;</span> cb2<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行watch重载2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行watch重载1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>范例：新增特性，Hello.vue</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>输入新特性<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addFeature<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">addFeature</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> KeyboardEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// e.target 是 EventTarget 类型，需要断言为 HTMLInputElement</span>
  <span class="token keyword">const</span> inp <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement
  <span class="token keyword">const</span> feature<span class="token operator">:</span> FeatureSelect <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> inp<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    selected<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
  inp<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
<span class="token punctuation">}</span>
</code></pre></div><p>范例：生命周期钩子，Hello.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code>created() {
  this.features = [{ id:1, name: '类型注解' }]
}
</code></pre></div><h3 id="类"><a href="#类" class="header-anchor">#</a> 类</h3> <h4 id="class-的特性"><a href="#class-的特性" class="header-anchor">#</a> class 的特性</h4> <p>TS 中的类和 ES6 中大体相同，这里重点关注 TS 带来的访问控制等特性。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 03-class.ts</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> _foo <span class="token operator">=</span> <span class="token string">'foo'</span>  <span class="token comment">// 私有属性，不能在类的外部访问</span>
  <span class="token keyword">protected</span> bar <span class="token operator">=</span> <span class="token string">'bar'</span>  <span class="token comment">// 保护属性，可以在子类中使用</span>

  <span class="token comment">// 参数属性：构造函数参数加修饰符，能够定义为成员属性</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> tua <span class="token operator">=</span> <span class="token string">'tua'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 方法也有修饰符</span>
  <span class="token keyword">private</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 存取器：属性方式访问，可添加额外逻辑，控制读写性</span>
  <span class="token keyword">get</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_foo
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_foo <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>范例：利用 getter 设置计算属性，Hello.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>特性数量：{{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义getter作为计算属性</span>
    <span class="token keyword">get</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h3> <p>接口仅约束结构，不要求实现，使用更简单</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 04-interface</span>
<span class="token comment">// Person接口定义了结构</span>
<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// greeting函数通过Person接口约束参数解构</span>
<span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">person<span class="token operator">:</span> Person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
<span class="token punctuation">}</span>
<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>firstName<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 正确</span>
<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>firstName<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 错误</span>
</code></pre></div><p>范例：Feature 也可用接口形式约束，./types/index.ts</p> <p>接口中只需定义结构，不需要初始化</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Feature</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#interfaces-vs-type-aliases" target="_blank" rel="noopener noreferrer">Interface vs type aliases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h3> <p>泛型（Generics）是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。以此<strong>增加代码通用性</strong>。</p> <p>不使用泛型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>
  ok<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> Feature<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用泛型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  ok<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>泛型方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> getResult<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>ok<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用尖括号方式指定T为string</span>
getResult<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token comment">// 用类型推断指定T为number</span>
<span class="token function">getResult</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>泛型优点</strong>：</p> <ul><li><p>函数和类可以支持多种类型，更加通用；</p></li> <li><p>不必编写多条重载，冗长联合类型，可读性好；</p></li> <li><p>灵活控制类型约束；</p></li></ul> <p>不仅通用且能灵活控制，泛型被广泛用于通用库的编写。</p> <p>范例：用 axios 获取数据</p> <p>配置模拟一个接口，vue.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token function">   before</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;类型注解&quot;</span><span class="token punctuation">,</span> version<span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;编译型语言&quot;</span><span class="token punctuation">,</span> version<span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用接口，HelloWorld.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code>  async mounted () {
    const resp = await axios.get<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FeatureSelect[]</span><span class="token punctuation">&gt;</span></span>('/api/list')
    this.features = resp.data
  }
</code></pre></div><h3 id="声明文件"><a href="#声明文件" class="header-anchor">#</a> 声明文件</h3> <p>使用 TS 开发时如果要使用第三方 JS 库的同时还想利用 TS 诸如类型检查等特性就需要声明文件，类似 xx.d.ts。</p> <p>同时，Vue 项目中还可以在 shims-vue.d.ts 中对已存在模块进行补充。</p> <div class="language- extra-class"><pre class="language-text"><code>npm i @types/xxx
</code></pre></div><p>范例：利用模块补充 $axios 属性到 Vue 实例，从而在组件里面直接用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$axios <span class="token operator">=</span> axios
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// shims-vue.d.ts</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'axios'</span>

declare module <span class="token string">'vue/types/vue'</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
    $axios<span class="token operator">:</span> AxiosInstance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>范例：给 router/index.js 编写声明文件，index.d.ts</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
declare <span class="token keyword">const</span> router<span class="token operator">:</span> VueRouter
<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre></div><h3 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h3> <p>装饰器用于扩展类或者它的属性和方法，@xxx 就是装饰器的写法。</p> <h4 id="属性声明：-prop"><a href="#属性声明：-prop" class="header-anchor">#</a> 属性声明：@Prop</h4> <p>除了在 @Component 中声明，还可以采用 @Prop 的方式声明组件属性。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  <span class="token comment">// Props() 参数是为 Vue 提供属性选项，加括号说明 prop 是一个装饰器工厂，返回的才是装饰器，参数一般是配置对象</span>
  <span class="token comment">// ！称为明确赋值断言，它是提供给 TS 的</span>
  @<span class="token function">Prop</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> msg<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token comment">// 这行约束是写给 TS 编译器的</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="事件处理：-emit"><a href="#事件处理：-emit" class="header-anchor">#</a> 事件处理：@Emit</h4> <p>新增特性时派发事件通知，Hello.vue</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 通知父类新增事件，若未指定事件名则函数名作为事件名（羊肉串形式）</span>
@<span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token function">addFeature</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 若没有返回值形参将作为事件参数</span>
  <span class="token keyword">const</span> feature <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
  event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">return</span> feature  <span class="token comment">// 若有返回值则返回值作为事件参数</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="变更监测：-watch"><a href="#变更监测：-watch" class="header-anchor">#</a> 变更监测：@Watch</h4> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Watch</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">)</span>
<span class="token function">onMsgChange</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span> oldVal<span class="token operator">:</span><span class="token builtin">any</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span>oldVal<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="状态管理推荐使用：vuex-module-decorators"><a href="#状态管理推荐使用：vuex-module-decorators" class="header-anchor">#</a> 状态管理推荐使用：<a href="https://github.com/championswimmer/vuex-module-decorators" target="_blank" rel="noopener noreferrer">vuex-module-decorators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p><a href="https://github.com/championswimmer/vuex-module-decorators" target="_blank" rel="noopener noreferrer">vuex-module-decorators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 通过装饰器提供模块化声明 Vuex 模块的方法，可以有效利用 TS 的类型系统。</p> <p>安装</p> <div class="language- extra-class"><pre class="language-text"><code>npm i vuex-modulw-decorators -D
</code></pre></div><p>根模块清空，修改 store/index.ts</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>定义 counter 模块，创建 store/counter</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> VuexModule<span class="token punctuation">,</span> Mutation<span class="token punctuation">,</span> Action<span class="token punctuation">,</span> getModule <span class="token punctuation">}</span> <span class="token keyword">from</span> 'vuex<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>
decorators'
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./index'</span>
<span class="token comment">// 动态注册模块</span>
@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dynamic<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> store<span class="token operator">:</span> store<span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'counter'</span><span class="token punctuation">,</span> namespaced<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">CounterModule</span> <span class="token keyword">extends</span> <span class="token class-name">VuexModule</span> <span class="token punctuation">{</span>
  count <span class="token operator">=</span> <span class="token number">1</span>
  @Mutation
  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过this直接访问count</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 定义getters</span>
  <span class="token keyword">get</span> <span class="token function">doubleCount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  @Action
  <span class="token function">asyncAdd</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过this直接访问add</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 导出模块应该是getModule的结果</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">getModule</span><span class="token punctuation">(</span>CounterModule<span class="token punctuation">)</span>
</code></pre></div><p>使用，App.vue</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{$store.state.counter.count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>asyncAdd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> CounterModule <span class="token keyword">from</span> <span class="token string">'@/store/counter'</span>
@Component
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span> 
 <span class="token keyword">get</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> CounterModule<span class="token punctuation">.</span>count
<span class="token punctuation">}</span>
<span class="token function"> add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  CounterModule<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function"> asyncAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  CounterModule<span class="token punctuation">.</span><span class="token function">asyncAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="装饰器原理"><a href="#装饰器原理" class="header-anchor">#</a> 装饰器原理</h3> <p>装饰器是加工厂函数，他能访问和修改装饰目标。</p> <p><strong>类装饰器</strong>：类装饰器表达式会在运行时当作函数被调用，类的构造函数作为其唯一的参数。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> <span class="token builtin">Function</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// target 是构造函数</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target <span class="token operator">===</span> Foo<span class="token punctuation">)</span> <span class="token comment">// true</span>
  target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@log
<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">{</span>
  bar <span class="token operator">=</span> <span class="token string">'bar'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// @ts-ignore</span>
foo<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>方法装饰器</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">rec</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> descriptor<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里通过修改descriptor.value扩展了bar方法</span>
  <span class="token keyword">const</span> baz <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value
  descriptor<span class="token punctuation">.</span><span class="token function-variable function">value</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run method'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token function">baz</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">{</span>
  @rec
  <span class="token function">setBar</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span><span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

foo<span class="token punctuation">.</span><span class="token function">setBar</span><span class="token punctuation">(</span><span class="token string">'lalala'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>属性装饰器</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">mua</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  target<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'mua~'</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">{</span>
  @mua ns<span class="token operator">!</span><span class="token operator">:</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>ns<span class="token punctuation">)</span>
</code></pre></div><p>稍微改造一下使其可以接收参数：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">mua</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token operator">:</span><span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> param
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实战一下：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>ts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Vue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-property-decorator&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    msg<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Decor</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>显然 options 中的选项都可以从 Decor 定义中找到。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><p>TypeScript：<a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">https://www.typescriptlang.org/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>TypeScript 支持 Vue：<a href="https://cn.vuejs.org/v2/guide/typescript.html" target="_blank" rel="noopener noreferrer">https://cn.vuejs.org/v2/guide/typescript.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/web/vue/07服务端渲染SSR.html" class="prev">
        07服务端渲染SSR
      </a></span> <span class="next"><a href="/blog/web/vue/09项目最佳实践.html">
        09项目最佳实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.5357dcc8.js" defer></script><script src="/blog/assets/js/2.ef134f65.js" defer></script><script src="/blog/assets/js/14.56b0e56b.js" defer></script>
  </body>
</html>
